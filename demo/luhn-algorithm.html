<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">

        <title>Luhn Algorithm | Matthew Grove</title>
        <meta name="description" content="Replication of the Luhn Algorithm - by Matthew Grove">
        <link rel="icon" href="/logo.jpg">

        <!-- import Roboto (font) -->
        <link href="/assets/roboto.css" rel="stylesheet">

        <!-- import Material Design components & icons -->
        <link rel="stylesheet" type="text/css" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
        rel="stylesheet">
        <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>

        <style>
            /* change material design theme */
            :root {
                --mdc-theme-primary: #d84315;
                --mdc-theme-secondary: #00838f;
            }
            .mdc-text-field--focused:not(.mdc-text-field--disabled) .mdc-floating-label {
                color: var(--mdc-theme-primary);
            }
            .mdc-fab {
                background-color: #00838f;
            }

            body {
                font-family: 'Roboto', sans-serif;
                text-align: center;
            }
            .mdc-text-field-helper-text {
                margin-bottom: 10px;
            }
            .source-code-link {
                position: fixed;
                bottom: 15px;
                right: 15px;
            }
        </style>

    </head>
    <body>
        <h1>Luhn Algorithm</h1>
        <!-- input field -->
        <div class="mdc-text-field mdc-text-field--outlined" data-mdc-auto-init="MDCTextField">
          <input type="text" id="tf-outlined" class="mdc-text-field__input">
          <label for="tf-outlined" class="mdc-floating-label ">Your Number</label>
          <div class="mdc-notched-outline">
            <svg>
              <path class="mdc-notched-outline__path"/>
            </svg>
          </div>
          <div class="mdc-notched-outline__idle"></div>
        </div>
        <!-- input field helper text -->
        <p class="mdc-text-field-helper-text" aria-hidden="true">
          Validate with the Luhn Algorithm
        </p>
        <!-- button to submit & check number with Luhn algorithm -->
        <button class="validation_button mdc-button mdc-button--outlined"  data-mdc-auto-init="MDCRipple" onclick="checkNumber()">
          <i class="material-icons mdc-button__icon">check_circle_outline</i>
          Check
        </button>
        <!-- displays evaluation of number by Luhn algorithm -->
        <p id="validation_message"></p>

        <!-- link to source code on GitHub -->
        <a class="source-code-link mdc-fab mdc-fab--extended" data-mdc-auto-init="MDCRipple">
            <span class="material-icons mdc-fab__icon">rate_review</span>
            <span class="mdc-fab__label">View on GitHub</span>
        </a>
    </body>
    <script>
        // initiate material design animations
        mdc.autoInit();

        document.addEventListener("keyup", function(event) {
            // stop any code that may normally run when enter key pressed
            event.preventDefault();
            // if enter key is pressed, run Luhn algorithm
            if (event.keyCode === 13) {
                checkNumber();
            } else {
                // if number in input field is being edited, remove previous number evaluation message
                document.getElementById("validation_message").innerHTML = null;
            }
        });

        // function for adding all the digits
        function sumDigits(total,digit) {
            return total + digit;
        }

        // function for validating number entered with Luhn algorithm
        function checkNumber() {
            // reverse digits in number
            var digits = String(document.getElementsByTagName("input")[0].value).split("");
            digits = digits.reverse();
            // makes sure only every other digit (counting from the right) is doubled
            var startingIndex = (digits.length % 2 == 0) ? 0 : 1;
            // doubles every other digit
            for (var i = startingIndex; i < digits.length; i += 2) {
                var newDigit = Number(digits[i]) * 2;
                // if doubled digit is two digits, add them
                while (newDigit > 9) {
                    var newDigits = String(newDigit).split("");
                    newDigit = 0;
                    newDigits.forEach(function(item) {
                        newDigit += Number(item);
                    });
                }
                // replace old digit with new one
                digits[i] = newDigit;
            }
            // convert all digits to numbers (some were strings)
            digits.forEach(function(item, index) {
                digits[index] = Number(item);
            });
            // sum the digits
            var sum = digits.reduce(sumDigits);
            // check if number is valid by moduloing it by 10
            switch (sum % 10 == 0) {
                // display appropriate evaluation message on page
                case true:
                    document.getElementById("validation_message").innerHTML = "Number is valid";
                    break;
                case false:
                    document.getElementById("validation_message").innerHTML = "Number is invalid";
                    break;
            }
        }
   </script>
</html>
